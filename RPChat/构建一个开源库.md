<h2><center>构建自己的开源库</center></h2>

<h3>新建工程</h3>

1、登录GitHub,新建一个仓库，命名为`RPBannerView-Swift`,此处我选的是MIT开源协议。

![A1](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d55bf57cea9e4c3a93cd6a538341afc1~tplv-k3u1fbpfcp-zoom-1.image)

2、在本地新建一个`RPBannerView-Swift`文件夹,并将刚创建的代码clone到该文件中

![A2](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/736cd021fa8e478785322fe44e7817ba~tplv-k3u1fbpfcp-zoom-1.image)

3、在该文件夹中新建一个工程，命名为`RPBannerView-Swift`,完成后上传代码到`GitHub`上。

```
cd Desktop/RPBannerView-Swift/
git clone https://github.com/dengfeng520/RPBannerView-Swift.git
git add ./
git commit -a -m "上传代码"
git push origin master
git ll // 查看上传记录
```

4、iOS 版本兼容

![A3](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2b9b84f5c5247cd972dc310b9f8f628~tplv-k3u1fbpfcp-zoom-1.image)

打开`RPBannerView-Swift`工程，修改最低支持版本为iOS 11，此时build工程，会报错。在`AppDelegate`和`SceneDelegate`做兼容处理即可。

* in AppDelegate.swift

```
@available(iOS 13.0, *)
extension AppDelegate {
    // MARK: UISceneSession Lifecycle
    func application(_ application: UIApplication, configurationForConnecting connectingSceneSession: UISceneSession, options: UIScene.ConnectionOptions) -> UISceneConfiguration {
        // Called when a new scene session is being created.
        // Use this method to select a configuration to create the new scene with.
        return UISceneConfiguration(name: "Default Configuration", sessionRole: connectingSceneSession.role)
    }
    
    func application(_ application: UIApplication, didDiscardSceneSessions sceneSessions: Set<UISceneSession>) {
        // Called when the user discards a scene session.
        // If any sessions were discarded while the application was not running, this will be called shortly after application:didFinishLaunchingWithOptions.
        // Use this method to release any resources that were specific to the discarded scenes, as they will not return.
    }
}
```

* in SceneDelegate.Swift

```
@available(iOS 13.0, *)
class SceneDelegate: UIResponder, UIWindowSceneDelegate {

}
```


<h3> Carthage </h3>

* 1、新建framework

编译工程成功后新建一个`framework `,命名为`RPBannerView`,

![A4](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/00a019c75ec24fe49b30347a51c30c43~tplv-k3u1fbpfcp-zoom-1.image)

![A5](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a0191b3866d46179b9cc56bfe3afb5b~tplv-k3u1fbpfcp-zoom-1.image)

![A6](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8609abb571da4959a095fb10fc667fba~tplv-k3u1fbpfcp-zoom-1.image)


 * 2、完成后修改`RPBannerView.framework`的最低版本为iOS 11，
  
  选中新建的`RPBannerView.framework` --> `Build Settings` --> `iOS deployment Target` --> `iOS 11`

![A7](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7866f527975e43a1beaec010db90268e~tplv-k3u1fbpfcp-zoom-1.image)

*  3、添加`RPBannerView.framework`要编译的文件，
    
    选中`RPBannerView.framework` --> `Build Phases` 
    把需要编译的文件导入即可。

![A8](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39671e49f6d24516875cf9e7d8aef50a~tplv-k3u1fbpfcp-zoom-1.image)

* 4、新建Xcode schemes

选择 Manager Schemes --> 勾选shared

![A9](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f72aaa459de432c8d0ff2427eab6f73~tplv-k3u1fbpfcp-zoom-1.image)

![A10](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93942a9f815742e5b4b6b9c574415ac9~tplv-k3u1fbpfcp-zoom-1.image)

* 5、编译FrameWork

切换到`RPBannerView.framework`,**此处要注意，不要选择模拟器！！**

![A11](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a05088d01a57408ca17adc34c5769afd~tplv-k3u1fbpfcp-zoom-1.image)


在Terminal中cd到工程文件，执行build命令，

```
cd Desktop/RPBannerView-Swift/
carthage build --no-skip-current
```

一般情况下第一次build可能会报错，目前不知道是什么原因造成的。

`Skipped building RPBannerView-Swift due to the error:
Dependency "RPBannerView-Swift" has no shared framework schemes`

解决报错方法：打开**Manage Schemes**，取消勾选**RPBannerView**,点击Close,然后再次打开重新勾选即可。
重新build成功。

`Building scheme "RPBannerView" in RPBannerView-Swift.xcodeproj`

![A13](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4af071e4617d4ff092930a3f28a054b3~tplv-k3u1fbpfcp-zoom-1.image)

编译成功后打开工程文件可以看到多了一个`Carthage`文件，逐步点开：`Carthage` --> `Build` --> `iOS` --> `RPBannerView.framework`是编译成功后的文件。

* 6、上传`RPBannerView-FrameWork`到GitHub

编译成功后需要把代码上传到GitHub并开源才可以让其他人通过`Carthage`来使用这个开源库。

```
cd Desktop/RPBannerView-Swift/
git add ./
git commit -a -m "update code"
git push origin master
```

* 7、创建tag

在上传到GitHub后需要创建一个tag，以此来确定这个库的版本。

```
cd Desktop/RPBannerView-Swift/
git tag 1.0
git push --tags
```
* 8、验证是否成功

新建一个工程，命名为`RPBannerViewDemo`,在`Cartfile`文件中导入上传的库，然后更新carthage，如果成功说明

```
cd RPBannerViewDemo
touch Cartfile
Vim Cartfile
github "dengfeng520/RPBannerView-Swift"
Esc -> :wq
carthage update --platform iOS --no-use-binaries
```

`--platform` iOS是指定平台默认是全平台架构的，`--no-use-binaries`是不用预编译的二进制，用源码重新编译二进制，如果不指定，网络不好的情况下会报错。

如果工程中已经使用了`Carthage`,只需要更新`RPBannerView-Swift`即可。

```
carthage update RPBannerView-Swift --platform iOS
```

更新完成后,打开工程，选择TARGETS -->Build Phases--> Link Binary With Libries 点击加号，选择 Add File --> Carthage --> Build --> iOS 添加RPBannerView.FrameWork.


![A14](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/10f954d7f6184642a34313a7c57629c6~tplv-k3u1fbpfcp-zoom-1.image)

```
/usr/local/bin/Carthage copy-frameworks
```

接下来，点击+，选择New Run Script Phase，此时新建了Run Script,在执行命令中添加:


```
$(SRCROOT)/Carthage/Build/iOS/RPBannerView.framework
```


![A15](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f880d295210e43fbb6ec934d16804d50~tplv-k3u1fbpfcp-zoom-1.image)

然后就可以在工程中愉快的使用自己的开源库了。

```
import RPBannerView

RPBanner.showBanner(BannerDisplay(title: "test loading..." ,backColor: UIColor.red, addView: view))
```

![A16](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/500920f90ca1485ca638e5db82af1771~tplv-k3u1fbpfcp-zoom-1.image)

![A17](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f002b0aecf144ce6a9265c2a3aab5d50~tplv-k3u1fbpfcp-zoom-1.image)

<h3> CocoaPods </h3>

* 1、创建RPBannerView-Swift.podspec

```
cd Desktop/RPBannerView-Swift/
pod spec create RPBannerView-Swift
vim RPBannerView-Swift.podspec
```

* 2、编辑RPBannerView-Swift.podspec

```
Pod::Spec.new do |spec|
spec.name         = "RPBannerView-Swift"
spec.version      = "1.0"
spec.summary      = "A short description of RPBannerView."
spec.description  = "RPBannerView-Swift"
spec.homepage     = "https://github.com/dengfeng520/RPBannerView-Swift"
spec.license      = { :type => "MIT", :file => "LICENSE" }
spec.author             = { "dengfeng520" => "deng_feng520@163.com" }
spec.platform     = :ios
spec.ios.deployment_target = "11.0"
spec.source       = { :git => "https://github.com/dengfeng520/RPBannerView-Swift", :tag => "#{spec.version}" }
spec.source_files  = "RPBannerView-Swift/RPBannerView/*.swift"
spec.framework  = "Foundation", "UIKit"
end
```

* 3、保存podspec文件，然后验证

```
pod spec lint RPBannerView-Swift.podspec --allow-warnings
```

验证成功提交到CocoaPods/Specs代码库中，让其他人也可以通过`pod install`命令安装开源库。

验证成功提示：

```
RPBannerView-Swift.podspec passed validation. 
```

如果没有注册CocoaPods帐号，可以通过以下命令注册CocoaPods帐号，

```
pod trunk register deng_feng520@163.com 'dengfeng520' --description='dengfeng520'

```
查看CocoaPods帐号信息：

```
pod trunk me
```

* 4、发布到CocoaPods

如果已经注册了，直接发布到CocoaPods服务器：

```
pod trunk push RPBannerView-Swift.podspec --allow-warnings
```

![B1](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe9718dd81a64161b278eebfe0240cb8~tplv-k3u1fbpfcp-zoom-1.image)


发布成功后更新CocoaPods本地库:

```
 pod setup
```
然后搜索

```
pod search RPBannerView-Swift
```

* 5、在项目中验证是否可以使用

```
cd RPBannerViewDemo
pod init
Vim Podfile
pod 'RPBannerView-Swift', :git => 'https://github.com/dengfeng520/RPBannerView-Swift'
Esc -> :wq
pod install

```

pod 下载成功后，即可在项目中使用这个库。


<h3> 添加Badge </h3>

我们可以通过

参考博客： [GitHub 项目徽章的添加和设置](http://www.cocoachina.com/articles/19256)

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b43f73955264f628fcdbcbe8341fe59~tplv-k3u1fbpfcp-zoom-1.image)

<h3> 使用 Codecov 展示测试覆盖率 </h3>

使用[codecov](https://codecov.io/)在线服务，生成显示代码覆盖率的 badge。授权用 GitHub 直接登录。登录后，点击 Add new repository，选择一个 GitHub 项目。

